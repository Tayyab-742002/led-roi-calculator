<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LED Retrofit ROI Calculator</title>
    <style>
      /* CSS Reset  */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      :root {
        --primary-color: #1f377e;
        --secondary-color: #1f377e;
        --accent-color: #1f377e;
        --background-color: #f8f9fa;
        --surface-color: #ffffff;
        --text-primary: #1f377e;
        --text-secondary: #6c757d;
        --border-color: #e0e6ed;
        --shadow-light: 0 2px 8px rgba(31, 55, 126, 0.1);
        --shadow-medium: 0 4px 16px rgba(31, 55, 126, 0.15);
        --border-radius: 8px;
        --transition: all 0.3s ease;
        --spacing-xs: 0.5rem;
        --spacing-sm: 1rem;
        --spacing-md: 1.5rem;
        --spacing-lg: 2rem;
        --spacing-xl: 3rem;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: var(--background-color);
        color: var(--text-primary);
        line-height: 1.6;
        min-height: 100vh;
        font-size: 16px;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: var(--spacing-xs);
      }

      /* Header  */
      .header {
        background: linear-gradient(
          135deg,
          var(--surface-color) 0%,
          #f8f9fa 100%
        );
        color: var(--text-primary);
        padding: var(--spacing-sm);
        border-radius: var(--border-radius);
        margin-bottom: var(--spacing-sm);
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: var(--spacing-sm);
        border: 2px solid var(--primary-color);
        box-shadow: var(--shadow-light);
      }

      .header-left {
        display: flex;
        align-items: center;
        gap: var(--spacing-md);
        flex-wrap: wrap;
      }

      .logo {
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
      }

      .logo img {
        height: 50px;
        width: auto;
        filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
      }

      .header h1 {
        font-size: clamp(1.2rem, 3vw, 2rem);
        font-weight: 300;
        margin: 0;
        color: var(--text-primary);
        line-height: 1.2;
      }

      .header-buttons {
        display: flex;
        gap: var(--spacing-sm);
        flex-wrap: wrap;
        align-items: center;
      }

      .btn {
        padding: 0.5rem 1rem;
        border: none;
        border-radius: var(--border-radius);
        cursor: pointer;
        font-weight: 600;
        font-size: 0.8rem;
        transition: var(--transition);
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        white-space: nowrap;
        min-height: 36px;
      }

      .btn-primary {
        background: linear-gradient(
          135deg,
          var(--primary-color) 0%,
          #2a4a9e 100%
        );
        color: var(--surface-color);
        box-shadow: var(--shadow-light);
        border: 1px solid var(--primary-color);
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-medium);
      }

      .btn-secondary {
        background: var(--surface-color);
        color: var(--primary-color);
        border: 2px solid var(--primary-color);
      }

      .btn-secondary:hover {
        background: #e9ecef;
        border-color: #adb5bd;
        transform: translateY(-1px);
      }

      /* General Inputs  */
      .general-inputs {
        background: var(--surface-color);
        padding: var(--spacing-sm);
        border-radius: var(--border-radius);
        margin-bottom: var(--spacing-sm);
        box-shadow: var(--shadow-light);
        border: 1px solid var(--border-color);
      }

      .general-inputs h2 {
        color: var(--text-primary);
        margin-bottom: var(--spacing-sm);
        font-size: 1.2rem;
        font-weight: 600;
      }

      .input-group {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: var(--spacing-sm);
        align-items: end;
      }

      .input-field {
        display: flex;
        flex-direction: row;
        align-items: center;
        gap: var(--spacing-xs);
      }

      /* Keep input and its unit together */
      .input-control {
        display: flex;
        align-items: center;
        gap: var(--spacing-xs);
        flex: 1;
        min-width: 220px;
      }

      .input-field label {
        font-weight: 600;
        color: var(--text-primary);
        font-size: 0.8rem;
        min-width: 120px;
        flex-shrink: 0;
      }

      .input-field input {
        padding: 0.5rem;
        border: 1px solid var(--border-color);
        border-radius: var(--border-radius);
        font-size: 0.9rem;
        transition: var(--transition);
        background: var(--surface-color);
        flex: 1;
        min-width: 0; /* allow shrinking within grid/flex to avoid overflow */
      }

      .input-field input:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(31, 55, 126, 0.1);
      }

      /* Unit chip shown next to inputs */
      .unit-chip {
        background: var(--primary-color);
        color: var(--surface-color);
        padding: 0.5rem 0.75rem;
        border-radius: var(--border-radius);
        font-weight: 700;
        font-size: 0.8rem;
        white-space: nowrap;
        line-height: 1;
        flex: 0 0 auto; /* prevent shrinking into input */
      }

      /* Comparison Sections */
      .comparison-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
        gap: var(--spacing-sm);
        margin-bottom: var(--spacing-sm);
      }

      .comparison-section {
        background: var(--surface-color);
        padding: var(--spacing-sm);
        border-radius: var(--border-radius);
        box-shadow: var(--shadow-light);
        border: 1px solid var(--border-color);
      }

      .comparison-section h2 {
        color: var(--text-primary);
        margin-bottom: var(--spacing-sm);
        font-size: 1.2rem;
        text-align: left;
        font-weight: 600;
      }

      .baseline h2 {
        color: var(--primary-color);
      }

      .proposed h2 {
        color: var(--primary-color);
      }

      .form-group {
        margin-bottom: var(--spacing-sm);
        display: flex;
        flex-direction: row;
        align-items: center;
        gap: var(--spacing-xs);
      }

      .form-group label {
        font-weight: 600;
        color: var(--text-primary);
        font-size: 0.8rem;
        min-width: 140px;
        flex-shrink: 0;
      }

      .form-group input,
      .form-group select {
        padding: 0.5rem;
        border: 1px solid var(--border-color);
        border-radius: var(--border-radius);
        font-size: 0.9rem;
        transition: var(--transition);
        background: var(--surface-color);
        flex: 1;
      }

      .form-group input:focus,
      .form-group select:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(31, 55, 126, 0.1);
      }

      /* Results Display */
      .results {
        color: white;
        padding: var(--spacing-sm);
        border-radius: var(--border-radius);
        margin-top: var(--spacing-sm);
        box-shadow: 0 4px 12px rgba(31, 55, 126, 0.9);
      }

      .results h3 {
        margin-bottom: var(--spacing-sm);
        color: black;
        font-size: 1rem;
        font-weight: 700;
      }

      .result-item {
        background: rgba(31, 55, 126, 0.5);
        display: flex;
        justify-content: space-between;
        padding: var(--spacing-sm);
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 4px;
        margin-bottom: var(--spacing-xs);
      }

      .result-item:last-child {
        margin-bottom: 0;
      }

      .result-label {
        font-weight: 600;
        opacity: 0.9;
        color: white;
      }

      .result-value {
        font-weight: bold;
        font-size: 1rem;
      }

      .proposed .results {
        color: black;
        box-shadow: 0 4px 12px rgba(31, 55, 126, 1);
      }

      .proposed .result-item {
        background: rgba(31, 55, 126, 0.9);
        border: 1px solid var(--primary-color);
        color: white;
      }
      /* Savings Section */
      .savings-section {
        background: var(--surface-color);
        padding: var(--spacing-md);
        border-radius: var(--border-radius);
        margin-bottom: var(--spacing-sm);
        box-shadow: var(--shadow-light);
        text-align: center;
        border: 1px solid var(--border-color);
      }

      .savings-section h2 {
        margin-bottom: var(--spacing-sm);
        font-size: clamp(1.2rem, 3vw, 1.5rem);
        font-weight: 700;
        color: var(--text-primary);
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      .savings-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: var(--spacing-sm);
        margin-top: var(--spacing-sm);
      }

      .savings-item {
        background: var(--surface-color);
        padding: var(--spacing-sm);
        border-radius: var(--border-radius);
        border: 1px solid var(--border-color);
        box-shadow: var(--shadow-light);
        transition: var(--transition);
      }

      .savings-item:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-medium);
      }

      .savings-value {
        font-size: clamp(1.2rem, 4vw, 2rem);
        font-weight: 800;
        margin-bottom: var(--spacing-xs);
        color: var(--primary-color);
      }

      .savings-label {
        font-size: 0.8rem;
        color: var(--text-secondary);
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      /* Chart Container */
      .chart-container {
        background: #f8f9fa;
        padding: 25px;
        border-radius: 8px;
        margin-bottom: 25px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        border: 2px solid #e9ecef;
      }

      .chart-content {
        margin-top: 25px;
      }

      .chart-div {
        display: none;
        min-height: 400px;
        background: white;
        border: 2px solid #dee2e6;
        border-radius: 8px;
        padding: 25px;
        text-align: center;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .chart-div.active {
        display: block;
      }

      .chart-div canvas {
        max-width: 100%;
        height: auto;
      }

      /* Control and Rebate Fields */
      .control-fields,
      .rebate-fields {
        transition: all 0.3s ease;
        opacity: 0;
        transform: translateY(-5px);
      }

      .control-fields.show,
      .rebate-fields.show {
        opacity: 1;
        transform: translateY(0);
      }

      .tabs {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin-bottom: 25px;
      }

      .tab {
        padding: 12px 24px;
        background: white;
        border: 2px solid #dee2e6;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 600;
        font-size: 14px;
        transition: all 0.3s ease;
        color: #495057;
      }

      .tab.active {
        background: rgba(31, 55, 126, 0.9);
        color: white;
        border-color: rgba(31, 55, 126, 0.9);
        box-shadow: 0 2px 8px rgba(31, 55, 126, 0.9);
      }

      .tab:hover:not(.active) {
        background: #f8f9fa;
        border-color: rgba(31, 55, 126, 0.9);
        color: rgba(31, 55, 126, 0.9);
      }

      /* Footer */
      .footer {
        background: #f8f9fa;
        padding: 25px;
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        text-align: center;
        border: 2px solid #e9ecef;
      }

      .disclaimer {
        color: #1f377e;
        font-size: 0.95rem;
        line-height: 1.7;
        font-weight: 500;
        text-align: left;
        background: #fff8db;
        border: 1px solid #ffe08a;
        border-left: 6px solid #f6c343;
        padding: 16px 18px;
        border-radius: 6px;
        display: grid;
        grid-template-columns: auto 1fr;
        gap: 12px;
        max-width: 1000px;
        margin: 0 auto;
      }

      .disclaimer-icon {
        width: 28px;
        height: 28px;
        border-radius: 50%;
        background: #f6c343;
        color: #1f377e;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 800;
        font-size: 0.9rem;
        box-shadow: 0 2px 6px rgba(246, 195, 67, 0.35);
        transform: translateY(2px);
      }

      .disclaimer-title {
        font-weight: 800;
        margin: 0 0 4px 0;
        letter-spacing: 0.3px;
        font-size: 1rem;
      }

      .disclaimer-content p {
        margin: 0;
      }

      .disclaimer a {
        color: #0d6efd;
        text-decoration: none;
        font-weight: 600;
        transition: color 0.3s ease;
      }

      .disclaimer a:hover {
        color: #0b5ed7;
        text-decoration: underline;
      }

      /* Responsive Design */
      @media (max-width: 1200px) {
        .container {
          max-width: 100%;
          padding: var(--spacing-sm);
        }
      }

      @media (max-width: 768px) {
        .header {
          flex-direction: column;
          text-align: center;
          gap: var(--spacing-md);
          padding: var(--spacing-sm);
        }

        .header-left {
          justify-content: center;
          flex-direction: column;
          gap: var(--spacing-sm);
        }

        .header-buttons {
          justify-content: center;
          width: 100%;
        }

        .btn {
          flex: 1;
          min-width: 120px;
          width: 100%;
        }

        .input-group {
          grid-template-columns: 1fr;
          gap: var(--spacing-md);
        }

        .input-field {
          flex-direction: column;
          align-items: stretch;
        }
        /* Keep input and unit chip together on small screens */
        .input-control {
          display: flex;
          align-items: center;
          gap: var(--spacing-xs);
          width: 100%;
        }

        .comparison-container {
          grid-template-columns: 1fr;
          gap: var(--spacing-md);
        }

        .comparison-section {
          padding: var(--spacing-md);
        }

        .savings-grid {
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
          gap: var(--spacing-md);
        }

        .savings-section {
          padding: var(--spacing-lg);
        }

        /* Stack labels and inputs for better readability */
        .form-group {
          flex-direction: column;
          align-items: stretch;
          gap: var(--spacing-xs);
        }
        .form-group label {
          min-width: 0;
        }
        .form-group input,
        .form-group select,
        .input-field input {
          width: 100%;
          font-size: 1rem;
          padding: 0.75rem;
        }
      }

      @media (max-width: 480px) {
        .container {
          padding: var(--spacing-xs);
        }

        .header {
          padding: var(--spacing-sm);
        }

        .logo img {
          height: 40px;
          width: auto;
        }

        .btn {
          padding: 0.5rem 1rem;
          font-size: 0.8rem;
          min-height: 40px;
          width: 100%;
        }

        .general-inputs,
        .comparison-section,
        .savings-section {
          padding: var(--spacing-sm);
        }

        .savings-grid {
          grid-template-columns: 1fr;
        }

        .form-group {
          margin-bottom: var(--spacing-sm);
          flex-direction: column;
          align-items: stretch;
          gap: var(--spacing-xs);
        }
        .form-group label {
          min-width: 0;
        }
        .form-group input,
        .form-group select,
        .input-field input {
          width: 100%;
          font-size: 1rem;
          padding: 0.75rem;
        }
      }

      @media (prefers-reduced-motion: reduce) {
        * {
          animation-duration: 0.01ms !important;
          animation-iteration-count: 1 !important;
          transition-duration: 0.01ms !important;
        }
      }

      .btn:focus,
      input:focus,
      select:focus {
        outline: 2px solid var(--primary-color);
        outline-offset: 2px;
      }

      /* Print Styles */
      @media print {
        /* Encourage the browser to print backgrounds for an on-screen match */
        * {
          -webkit-print-color-adjust: exact;
          print-color-adjust: exact;
        }

        @page {
          size: tabloid; /* 11in x 17in */
          margin: 12mm;
        }

        /* Do not alter sizes, paddings, or colors; preserve layout */
        .container {
          max-width: 100%;
        }

        /* Compact spacing */
        .comparison-section,
        .general-inputs,
        .results,
        .savings-section,
        .footer,
        .disclaimer,
        .chart-container {
          margin-top: 8px !important;
          margin-bottom: 8px !important;
          padding-top: 8px !important;
          padding-bottom: 8px !important;
        }

        .results .result-item {
          margin: 4px 0 !important;
        }
        .savings-grid {
          gap: 6px !important;
        }

        /* Prevent internal splits */
        .comparison-container,
        .comparison-section,
        .general-inputs,
        .results,
        .savings-section,
        .footer,
        .disclaimer,
        .chart-container,
        .chart-content,
        .form-group,
        .input-group,
        .comparison-section .results {
          /* reinforce keep-together for results */
          break-inside: avoid;
          page-break-inside: avoid;
          overflow: visible !important;
        }

        /* Page flow: Baseline page, Proposed page, then Analysis + Charts + Disclaimer */
        .comparison-section.baseline {
          break-before: page;
          page-break-before: always;
          break-after: page;
          page-break-after: always;
        }
        .comparison-section.proposed {
          break-before: auto;
          page-break-before: auto;
          break-after: page;
          page-break-after: always;
        }

        .savings-section {
          break-before: auto;
          page-break-before: auto;
        }
        .chart-container {
          break-before: auto;
          page-break-before: auto;
        }
        .footer,
        .disclaimer {
          break-before: auto;
          page-break-before: auto;
        }

        /* Charts scale */
        .chart-div canvas {
          max-width: 100% !important;
          height: auto !important;
          max-height: 20cm !important; /* keep within tabloid page height with other sections */
        }

        /* Disable transforms that can cause weird pagination */
        [style*="transform"],
        .transformed {
          transform: none !important;
        }

        /* Hide interactive controls */
        .header-buttons,
        .btn {
          display: none;
        }

        /* Proposed results text stays white over dark background */
        .proposed .results,
        .proposed .results h3,
        .proposed .result-item,
        .proposed .result-label,
        .proposed .result-value {
          color: #ffffff !important;
        }

        /* Improve paragraph splitting behavior */
        p {
          widows: 3;
          orphans: 3;
        }

        /* ==== A4/Narrow-page optimization: enforce structured grid for Baseline/Proposed ==== */
        @media (max-width: 220mm) {
          /* Use a 3-column grid to allow the Quantity/Watts/Cost and Control trio to be on one row */
          .comparison-section {
            display: grid !important;
            grid-template-columns: repeat(3, 1fr) !important;
            gap: 8px 12px !important;
            align-items: start;
          }

          /* Headings and block elements span full width */
          .comparison-section h2,
          .comparison-section h3,
          .comparison-section .results {
            grid-column: 1 / -1;
          }

          /* Baseline: description/catalog full width first row */
          .comparison-section.baseline .form-group:has(#baselineDescription),
          .comparison-section.baseline .form-group:has(#baselineCatalog) {
            grid-column: 1 / -1;
          }

          /* Baseline: Quantity, Watts, Cost on one row */
          .comparison-section.baseline .form-group:has(#baselineQuantity) {
            grid-column: 1 / 2;
          }
          .comparison-section.baseline .form-group:has(#baselineWatts) {
            grid-column: 2 / 3;
          }
          .comparison-section.baseline .form-group:has(#baselineCost) {
            grid-column: 3 / 4;
          }

          /* Baseline: control trio on one row */
          .comparison-section.baseline .form-group:has(#baselineControlQty) {
            grid-column: 1 / 2;
          }
          .comparison-section.baseline
            .form-group:has(#baselineControlReduction) {
            grid-column: 2 / 3;
          }
          .comparison-section.baseline .form-group:has(#baselineControlCost) {
            grid-column: 3 / 4;
          }

          /* Baseline: results full width at the end */
          .comparison-section.baseline .results {
            grid-column: 1 / -1;
          }

          /* Proposed: description/product full width first row */
          .comparison-section.proposed .form-group:has(#proposedDescription),
          .comparison-section.proposed .form-group:has(#proposedProduct),
          .comparison-section.proposed .form-group:has(#proposedCatalog) {
            grid-column: 1 / -1;
          }

          /* Proposed: Quantity, Watts, Cost on one row */
          .comparison-section.proposed .form-group:has(#proposedQuantity) {
            grid-column: 1 / 2;
          }
          .comparison-section.proposed .form-group:has(#proposedWatts) {
            grid-column: 2 / 3;
          }
          .comparison-section.proposed .form-group:has(#proposedCost) {
            grid-column: 3 / 4;
          }

          /* Proposed: control trio on one row */
          .comparison-section.proposed .form-group:has(#proposedControlQty) {
            grid-column: 1 / 2;
          }
          .comparison-section.proposed
            .form-group:has(#proposedControlReduction) {
            grid-column: 2 / 3;
          }
          .comparison-section.proposed .form-group:has(#proposedControlCost) {
            grid-column: 3 / 4;
          }

          /* Proposed: results full width at the end */
          .comparison-section.proposed .results {
            grid-column: 1 / -1;
          }

          /* Tighten inner spacing/typography further on A4 */
          .comparison-section {
            font-size: 0.92em !important;
            padding-top: 6px !important;
            padding-bottom: 6px !important;
          }
          .comparison-section .form-group {
            margin: 4px 0 !important;
          }
          .comparison-section h2 {
            margin: 4px 0 6px 0 !important;
          }
          .comparison-section h3 {
            margin: 4px 0 6px 0 !important;
          }
          .comparison-section .results .result-item {
            margin: 2px 0 !important;
          }
        }
      }
      /* Tablet layout: stack general parameters to prevent overlap */
      @media (max-width: 1024px) {
        .input-group {
          grid-template-columns: 1fr;
        }
        .input-control {
          flex-wrap: nowrap;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- Header -->
      <div class="header">
        <div class="header-left">
          <div class="logo">
            <img
              src="https://www.grizzlylighting.ca/web/image/4368-78d74930/Artboard%202.svg"
              alt="Grizzly Lighting Systems Logo"
            />
          </div>
          <h1>LED Retrofit ROI Calculator</h1>
        </div>
        <div class="header-buttons">
          <button class="btn btn-primary" onclick="toggleControls()">
            Add Control
          </button>
          <button class="btn btn-primary" onclick="toggleRebates()">
            Add Rebate
          </button>
          <button class="btn btn-secondary" onclick="printResults()">
            Print
          </button>
        </div>
      </div>

      <!-- General Inputs -->
      <div class="general-inputs">
        <h2>General Parameters</h2>
        <div class="input-group">
          <div class="input-field">
            <label for="electricityRate">Electricity Rate (c/kWh)</label>
            <div class="input-control">
              <input
                type="number"
                id="electricityRate"
                value="10"
                min="0"
                step="0.01"
                onchange="calculateAll()"
              />
              <span class="unit-chip">c/kWh</span>
            </div>
          </div>

          <div class="input-field">
            <label for="operationHours">Operation Hours</label>
            <div class="input-control">
              <input
                type="number"
                id="operationHours"
                value="12"
                min="0"
                max="24"
                step="0.5"
                onchange="calculateAll()"
              />
              <span class="unit-chip">day</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Comparison Sections -->
      <div class="comparison-container">
        <!-- Baseline Section -->
        <div class="comparison-section baseline">
          <h2>Baseline</h2>
          <div class="form-group">
            <label for="baselineDescription">Description/Catalog</label>
            <input
              type="text"
              id="baselineDescription"
              value="Test"
              placeholder="Enter current lighting description"
              onchange="calculateAll()"
            />
          </div>
          <div class="form-group">
            <label for="baselineQuantity">Quantity</label>
            <input
              type="number"
              id="baselineQuantity"
              value="10"
              min="0"
              onchange="calculateAll()"
            />
          </div>
          <div class="form-group">
            <label for="baselineWatts">Watts Per Luminaire</label>
            <input
              type="number"
              id="baselineWatts"
              value="70"
              min="0"
              onchange="calculateAll()"
            />
          </div>
          <div class="form-group">
            <label for="baselineCost">Cost Per Luminaire</label>
            <input
              type="number"
              id="baselineCost"
              value="12"
              min="0"
              step="0.01"
              onchange="calculateAll()"
            />
          </div>

          <!-- Control Fields  -->
          <h3
            style="
              margin-top: 25px;
              margin-bottom: 20px;
              color: #495057;
              font-size: 1rem;
              font-weight: 700;
              text-transform: uppercase;
              letter-spacing: 0.5px;
              border-bottom: 2px solid #dee2e6;
              padding-bottom: 10px;
            "
          >
            Lighting Control
          </h3>
          <div class="form-group control-fields" style="display: none">
            <label for="baselineControlQty">Control Quantity</label>
            <input
              type="number"
              id="baselineControlQty"
              value="12"
              min="0"
              onchange="calculateAll()"
            />
          </div>
          <div class="form-group control-fields" style="display: none">
            <label for="baselineControlReduction">Control Reduction (%)</label>
            <input
              type="number"
              id="baselineControlReduction"
              value="1"
              min="0"
              max="100"
              onchange="calculateAll()"
            />
          </div>
          <div class="form-group control-fields" style="display: none">
            <label for="baselineControlCost">Control Cost</label>
            <input
              type="number"
              id="baselineControlCost"
              value="0"
              min="0"
              step="0.01"
              onchange="calculateAll()"
            />
          </div>

          <!-- Rebate Fields  -->
          <h3
            style="
              margin-top: 25px;
              margin-bottom: 20px;
              color: #495057;
              font-size: 1.3rem;
              font-weight: 700;
              text-transform: uppercase;
              letter-spacing: 0.5px;
              border-bottom: 2px solid #dee2e6;
              padding-bottom: 10px;
            "
          >
            Rebates/Incidental Costs
          </h3>
          <div class="form-group rebate-fields" style="display: none">
            <label for="baselineRebateDescription">Rebate Description</label>
            <input
              type="text"
              id="baselineRebateDescription"
              placeholder="Enter rebate description"
              onchange="calculateAll()"
            />
          </div>
          <div class="form-group rebate-fields" style="display: none">
            <label for="baselineRebateValue">Rebate Value</label>
            <input
              type="text"
              id="baselineRebateValue"
              value="0"
              placeholder="Enter rebate value or calculation (e.g., 100 or 0.1*x)"
              onchange="calculateAll()"
            />
          </div>

          <!-- Baseline Results -->
          <div class="results">
            <h3>Baseline Results</h3>
            <div class="result-item">
              <span class="result-label">Initial Cost:</span>
              <span class="result-value" id="baselineInitialCost">$0</span>
            </div>
            <div class="result-item">
              <span class="result-label">Annual Energy Usage:</span>
              <span class="result-value" id="baselineAnnualEnergy"
                >0.00 kWh</span
              >
            </div>
            <div class="result-item">
              <span class="result-label">Annual Cost:</span>
              <span class="result-value" id="baselineAnnualCost">$0</span>
            </div>
          </div>
        </div>

        <!-- Proposed Section -->
        <div class="comparison-section proposed">
          <h2>Proposed</h2>
          <div class="form-group">
            <label for="proposedProduct">Product Selection</label>
            <select id="proposedProduct" onchange="updateProposedWatts()">
              <option value="">Select a product...</option>
            </select>
          </div>
          <div class="form-group">
            <label for="proposedWatts">Watts Per Luminaire</label>
            <input
              type="number"
              id="proposedWatts"
              value="70"
              min="0"
              readonly
            />
          </div>
          <div class="form-group">
            <label for="proposedLabourCost">Labour Cost (Total)</label>
            <input
              type="number"
              id="proposedLabourCost"
              value="0"
              min="0"
              step="0.01"
              onchange="calculateAll()"
            />
          </div>
          <!-- <div class="form-group">
            <label for="proposedDescription">Description/Catalog</label>
            <input
              type="text"
              id="proposedDescription"
              placeholder="Product description"
              readonly
            />
          </div> -->
          <div class="form-group">
            <label for="proposedQuantity">Quantity</label>
            <input
              type="number"
              id="proposedQuantity"
              value="10"
              min="0"
              onchange="calculateAll()"
            />
          </div>
          <div class="form-group">
            <label for="proposedCost">Cost Per Luminaire</label>
            <input
              type="number"
              id="proposedCost"
              value="12"
              min="0"
              step="0.01"
              onchange="calculateAll()"
            />
          </div>

          <!-- Control Fields  -->
          <h3
            style="
              margin-top: 25px;
              margin-bottom: 20px;
              color: #495057;
              font-size: 1rem;
              font-weight: 700;
              text-transform: uppercase;
              letter-spacing: 0.5px;
              border-bottom: 2px solid #dee2e6;
              padding-bottom: 10px;
            "
          >
            Lighting Control
          </h3>
          <div class="form-group control-fields" style="display: none">
            <label for="proposedControlQty">Control Quantity</label>
            <input
              type="number"
              id="proposedControlQty"
              value="12"
              min="0"
              onchange="calculateAll()"
            />
          </div>
          <div class="form-group control-fields" style="display: none">
            <label for="proposedControlReduction">Control Reduction (%)</label>
            <input
              type="number"
              id="proposedControlReduction"
              value="0"
              min="0"
              max="100"
              onchange="calculateAll()"
            />
          </div>
          <div class="form-group control-fields" style="display: none">
            <label for="proposedControlCost">Control Cost</label>
            <input
              type="number"
              id="proposedControlCost"
              value="0"
              min="0"
              step="0.01"
              onchange="calculateAll()"
            />
          </div>

          <!-- Rebate Fields  -->
          <h3
            style="
              margin-top: 25px;
              margin-bottom: 20px;
              color: #495057;
              font-size: 1.3rem;
              font-weight: 700;
              text-transform: uppercase;
              letter-spacing: 0.5px;
              border-bottom: 2px solid #dee2e6;
              padding-bottom: 10px;
            "
          >
            Rebates/Incidental Costs
          </h3>
          <div class="form-group rebate-fields" style="display: none">
            <label for="proposedRebateDescription">Rebate Description</label>
            <input
              type="text"
              id="proposedRebateDescription"
              placeholder="Enter rebate description"
              onchange="calculateAll()"
            />
          </div>
          <div class="form-group rebate-fields" style="display: none">
            <label for="proposedRebateValue">Rebate Value</label>
            <input
              type="text"
              id="proposedRebateValue"
              value="0"
              placeholder="Enter rebate value or calculation (e.g., 100 or 0.1*x)"
              onchange="calculateAll()"
            />
          </div>

          <!-- Proposed Results -->
          <div class="results">
            <h3>Proposed Results</h3>
            <div class="result-item">
              <span class="result-label">Initial Cost:</span>
              <span class="result-value" id="proposedInitialCost">$0</span>
            </div>
            <div class="result-item">
              <span class="result-label">Annual Energy Usage:</span>
              <span class="result-value" id="proposedAnnualEnergy"
                >0.00 kWh</span
              >
            </div>
            <div class="result-item">
              <span class="result-label">Annual Cost:</span>
              <span class="result-value" id="proposedAnnualCost">$0</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Savings Section -->
      <div class="savings-section">
        <h2>Economic Analysis</h2>
        <div class="savings-grid">
          <div class="savings-item">
            <div class="savings-value" id="annualSavings">$0</div>
            <div class="savings-label">Proposed Annual Savings</div>
          </div>
          <div class="savings-item">
            <div class="savings-value" id="energySavings">0.00 kWh</div>
            <div class="savings-label">Energy Savings</div>
          </div>
          <div class="savings-item">
            <div class="savings-value" id="paybackPeriod">0.0 Years</div>
            <div class="savings-label">Proposed Simple Payback</div>
          </div>
          <div class="savings-item">
            <div class="savings-value" id="monthlyCostOfWaiting">$0</div>
            <div class="savings-label">Monthly Cost of Waiting</div>
          </div>
          <div class="savings-item">
            <div class="savings-value" id="tenYearSavings">$0</div>
            <div class="savings-label">10-Year Savings</div>
          </div>
        </div>
      </div>

      <!-- Chart Container -->
      <div class="chart-container">
        <div class="tabs">
          <button class="tab active" onclick="showTab('tenYear')">
            10 Year
          </button>
          <button class="tab" onclick="showTab('cashflow')">Cashflow</button>
        </div>
        <div class="chart-content">
          <div id="chart_div" class="chart-div active"></div>
          <div id="cashflow_div" class="chart-div"></div>
        </div>
      </div>
    </div>

    <!-- Chart.js  -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
      const productCatalog = [
        {
          id: "tundra-70",
          name: "Tundra Area Light - 70 Watt",
          watts: 70,
          category: "Tundra Area Light",
        },
        {
          id: "tundra-100",
          name: "Tundra Area Light - 100 Watt",
          watts: 100,
          category: "Tundra Area Light",
        },
        {
          id: "tundra-150",
          name: "Tundra Area Light - 150 Watt",
          watts: 150,
          category: "Tundra Area Light",
        },
        {
          id: "tundra-200",
          name: "Tundra Area Light - 200 Watt",
          watts: 200,
          category: "Tundra Area Light",
        },
        {
          id: "tundra-240",
          name: "Tundra Area Light - 240 Watt",
          watts: 240,
          category: "Tundra Area Light",
        },
        {
          id: "tundra-300",
          name: "Tundra Area Light - 300 Watt",
          watts: 300,
          category: "Tundra Area Light",
        },

        {
          id: "orbix-70",
          name: "Orbix Round UFO Light - 70 Watt",
          watts: 70,
          category: "Orbix Round UFO Light",
        },
        {
          id: "orbix-100",
          name: "Orbix Round UFO Light - 100 Watt",
          watts: 100,
          category: "Orbix Round UFO Light",
        },
        {
          id: "orbix-150",
          name: "Orbix Round UFO Light - 150 Watt",
          watts: 150,
          category: "Orbix Round UFO Light",
        },
        {
          id: "orbix-180",
          name: "Orbix Round UFO Light - 180 Watt",
          watts: 180,
          category: "Orbix Round UFO Light",
        },
        {
          id: "orbix-200",
          name: "Orbix Round UFO Light - 200 Watt",
          watts: 200,
          category: "Orbix Round UFO Light",
        },
        {
          id: "orbix-240",
          name: "Orbix Round UFO Light - 240 Watt",
          watts: 240,
          category: "Orbix Round UFO Light",
        },

        {
          id: "alpine-80",
          name: "Alpine LED Wall Pack Light - 80 Watt",
          watts: 80,
          category: "Alpine LED Wall Pack Light",
        },
        {
          id: "alpine-100",
          name: "Alpine LED Wall Pack Light - 100 Watt",
          watts: 100,
          category: "Alpine LED Wall Pack Light",
        },
        {
          id: "alpine-120",
          name: "Alpine LED Wall Pack Light - 120 Watt",
          watts: 120,
          category: "Alpine LED Wall Pack Light",
        },

        {
          id: "raven-2x4-30",
          name: "Raven Backlit Flat Panel Light 2x4 - 30 Watt",
          watts: 30,
          category: "Raven Backlit Flat Panel Light 2x4",
        },
        {
          id: "raven-2x4-40",
          name: "Raven Backlit Flat Panel Light 2x4 - 40 Watt",
          watts: 40,
          category: "Raven Backlit Flat Panel Light 2x4",
        },
        {
          id: "raven-2x4-50",
          name: "Raven Backlit Flat Panel Light 2x4 - 50 Watt",
          watts: 50,
          category: "Raven Backlit Flat Panel Light 2x4",
        },
        {
          id: "raven-2x4-60",
          name: "Raven Backlit Flat Panel Light 2x4 - 60 Watt",
          watts: 60,
          category: "Raven Backlit Flat Panel Light 2x4",
        },
        {
          id: "raven-2x4-72",
          name: "Raven Backlit Flat Panel Light 2x4 - 72 Watt",
          watts: 72,
          category: "Raven Backlit Flat Panel Light 2x4",
        },

        {
          id: "raven-2x2-15",
          name: "Raven Backlit Flat Panel Light 2x2/1x4 - 15 Watt",
          watts: 15,
          category: "Raven Backlit Flat Panel Light 2x2/1x4",
        },
        {
          id: "raven-2x2-20",
          name: "Raven Backlit Flat Panel Light 2x2/1x4 - 20 Watt",
          watts: 20,
          category: "Raven Backlit Flat Panel Light 2x2/1x4",
        },
        {
          id: "raven-2x2-25",
          name: "Raven Backlit Flat Panel Light 2x2/1x4 - 25 Watt",
          watts: 25,
          category: "Raven Backlit Flat Panel Light 2x2/1x4",
        },
        {
          id: "raven-2x2-30",
          name: "Raven Backlit Flat Panel Light 2x2/1x4 - 30 Watt",
          watts: 30,
          category: "Raven Backlit Flat Panel Light 2x2/1x4",
        },
        {
          id: "raven-2x2-40",
          name: "Raven Backlit Flat Panel Light 2x2/1x4 - 40 Watt",
          watts: 40,
          category: "Raven Backlit Flat Panel Light 2x2/1x4",
        },
      ];

      // Initialize the calculator
      document.addEventListener("DOMContentLoaded", function () {
        populateProductDropdown();
        loadSavedData();

        document.querySelectorAll(".control-fields").forEach((field) => {
          field.style.display = "block";
          field.classList.add("show");
        });
        document.querySelectorAll(".rebate-fields").forEach((field) => {
          field.style.display = "block";
          field.classList.add("show");
        });

        // Update button text
        document.querySelector(
          'button[onclick="toggleControls()"]'
        ).textContent = "Hide Control";
        document.querySelector(
          'button[onclick="toggleRebates()"]'
        ).textContent = "Hide Rebate";

        setTimeout(() => {
          const select = document.getElementById("proposedProduct");
          select.value = "tundra-70";
          updateProposedWatts();
        }, 100);

        calculateAll();
      });

      function populateProductDropdown() {
        const select = document.getElementById("proposedProduct");
        select.innerHTML = '<option value="">Select a product...</option>';

        const categories = {};
        productCatalog.forEach((product) => {
          if (!categories[product.category]) {
            categories[product.category] = [];
          }
          categories[product.category].push(product);
        });

        Object.keys(categories).forEach((category) => {
          const optgroup = document.createElement("optgroup");
          optgroup.label = category;

          categories[category].forEach((product) => {
            const option = document.createElement("option");
            option.value = product.id;
            option.textContent = product.name;
            optgroup.appendChild(option);
          });

          select.appendChild(optgroup);
        });

        // Add custom option at the end
        const customOption = document.createElement("option");
        customOption.value = "other-custom";
        customOption.textContent = "Other (Custom Wattage)";
        select.appendChild(customOption);
      }

      function updateProposedWatts() {
        const select = document.getElementById("proposedProduct");
        const wattsInput = document.getElementById("proposedWatts");
        const descriptionInput = document.getElementById("proposedDescription");

        if (select.value === "other-custom") {
          // Enable manual watt entry for custom option
          wattsInput.readOnly = false;
          wattsInput.removeAttribute("readonly");
          // Keep whatever user types; do not overwrite here
        } else if (select.value) {
          const selectedProduct = productCatalog.find(
            (p) => p.id === select.value
          );
          if (selectedProduct) {
            wattsInput.value = selectedProduct.watts;
            if (descriptionInput) descriptionInput.value = selectedProduct.name;
          }
          wattsInput.readOnly = true;
          wattsInput.setAttribute("readonly", "readonly");
        } else {
          wattsInput.value = "";
          if (descriptionInput) descriptionInput.value = "";
          wattsInput.readOnly = true;
          wattsInput.setAttribute("readonly", "readonly");
        }

        calculateAll();
      }

      function calculateAll() {
        const electricityRate =
          parseFloat(document.getElementById("electricityRate").value) || 0;
        const operationHours =
          parseFloat(document.getElementById("operationHours").value) || 0;

        const baselineQuantity =
          parseInt(document.getElementById("baselineQuantity").value) || 0;
        const baselineWatts =
          parseFloat(document.getElementById("baselineWatts").value) || 0;
        const baselineCost =
          parseFloat(document.getElementById("baselineCost").value) || 0;

        const baselineControlQty =
          parseFloat(document.getElementById("baselineControlQty")?.value) || 0;
        const baselineControlReduction =
          parseFloat(
            document.getElementById("baselineControlReduction")?.value
          ) || 0;
        const baselineControlCost =
          parseFloat(document.getElementById("baselineControlCost")?.value) ||
          0;
        const baselineRebateValue = parseRebateValue(
          document.getElementById("baselineRebateValue")?.value
        );

        const proposedQuantity =
          parseInt(document.getElementById("proposedQuantity").value) || 0;
        const proposedWatts =
          parseFloat(document.getElementById("proposedWatts").value) || 0;
        const proposedCost =
          parseFloat(document.getElementById("proposedCost").value) || 0;

        const proposedControlQty =
          parseFloat(document.getElementById("proposedControlQty")?.value) || 0;
        const proposedControlReduction =
          parseFloat(
            document.getElementById("proposedControlReduction")?.value
          ) || 0;
        const proposedControlCost =
          parseFloat(document.getElementById("proposedControlCost")?.value) ||
          0;
        const proposedRebateValue = parseRebateValue(
          document.getElementById("proposedRebateValue")?.value
        );

        let baselineAnnualEnergy =
          (baselineQuantity * baselineWatts * operationHours * 365) / 1000;
        if (baselineControlQty > 0 && baselineControlReduction > 0) {
          baselineAnnualEnergy =
            baselineAnnualEnergy * (1 - baselineControlReduction / 100);
        }
        const baselineAnnualCost =
          baselineAnnualEnergy * (electricityRate / 100);
        let baselineInitialCost = baselineQuantity * baselineCost;
        if (baselineControlQty > 0 && baselineControlCost > 0) {
          baselineInitialCost += baselineControlQty * baselineControlCost;
        }
        if (baselineRebateValue > 0) {
          baselineInitialCost -= baselineRebateValue;
        }

        let proposedAnnualEnergy =
          (proposedQuantity * proposedWatts * operationHours * 365) / 1000;
        if (proposedControlQty > 0 && proposedControlReduction > 0) {
          proposedAnnualEnergy =
            proposedAnnualEnergy * (1 - proposedControlReduction / 100);
        }
        const proposedAnnualCost =
          proposedAnnualEnergy * (electricityRate / 100);
        let proposedInitialCost = proposedQuantity * proposedCost;
        const proposedLabourCost =
          parseFloat(document.getElementById("proposedLabourCost")?.value) || 0;
        if (proposedControlQty > 0 && proposedControlCost > 0) {
          proposedInitialCost += proposedControlQty * proposedControlCost;
        }
        if (proposedRebateValue > 0) {
          proposedInitialCost -= proposedRebateValue;
        }
        if (proposedLabourCost > 0) {
          proposedInitialCost += proposedLabourCost;
        }

        const annualSavings = baselineAnnualCost - proposedAnnualCost;
        const energySavings = Math.max(
          baselineAnnualEnergy - proposedAnnualEnergy,
          0
        );
        const monthlyCostOfWaiting = annualSavings / 12;
        const paybackPeriod =
          proposedInitialCost > 0 && annualSavings > 0
            ? proposedInitialCost / annualSavings
            : 0;
        const tenYearSavings = annualSavings * 10;

        updateDisplay(
          "baselineInitialCost",
          formatCurrency(baselineInitialCost)
        );
        updateDisplay(
          "baselineAnnualEnergy",
          formatEnergy(baselineAnnualEnergy)
        );
        updateDisplay("baselineAnnualCost", formatCurrency(baselineAnnualCost));

        updateDisplay(
          "proposedInitialCost",
          formatCurrency(proposedInitialCost)
        );
        updateDisplay(
          "proposedAnnualEnergy",
          formatEnergy(proposedAnnualEnergy)
        );
        updateDisplay("proposedAnnualCost", formatCurrency(proposedAnnualCost));

        updateDisplay("annualSavings", formatCurrency(annualSavings));
        updateDisplay("energySavings", formatEnergy(energySavings));
        updateDisplay(
          "monthlyCostOfWaiting",
          formatCurrency(monthlyCostOfWaiting)
        );
        updateDisplay("paybackPeriod", formatYears(paybackPeriod) + " Years");
        updateDisplay("tenYearSavings", formatCurrency(tenYearSavings));

        // Draw charts
        drawCharts(
          baselineInitialCost,
          proposedInitialCost,
          baselineAnnualCost,
          proposedAnnualCost
        );

        // Save data
        saveData();
      }

      function parseRebateValue(value) {
        if (!value || value === "") return 0;

        try {
          const expression = value.replace(/x/g, "*");
          const result = eval(expression);
          return isNaN(result) ? 0 : parseFloat(result);
        } catch (e) {
          return 0;
        }
      }

      // Chart drawing functions
      function drawCharts(
        baselineInitial,
        proposedInitial,
        baselineAnnual,
        proposedAnnual
      ) {
        drawTenYearChart(
          baselineInitial,
          proposedInitial,
          baselineAnnual,
          proposedAnnual
        );
        drawCashflowChart(
          baselineInitial,
          proposedInitial,
          baselineAnnual,
          proposedAnnual
        );
      }

      function drawTenYearChart(
        baselineInitial,
        proposedInitial,
        baselineAnnual,
        proposedAnnual
      ) {
        const ctx = document.getElementById("chart_div");
        if (!ctx) return;

        // Clear previous chart
        ctx.innerHTML = '<canvas id="tenYearChart"></canvas>';
        const canvas = document.getElementById("tenYearChart");

        const years = 11;
        const baselineData = [];
        const proposedData = [];
        const labels = [];

        for (let i = 0; i < years; i++) {
          if (i === 0) {
            labels[i] = "Initial";
            baselineData[i] = baselineInitial;
            proposedData[i] = proposedInitial;
          } else {
            labels[i] = `Year ${i}`;
            baselineData[i] = baselineData[i - 1] + baselineAnnual;
            proposedData[i] = proposedData[i - 1] + proposedAnnual;
          }
        }

        new Chart(canvas, {
          type: "bar",
          data: {
            labels: labels,
            datasets: [
              {
                label: "Baseline",
                data: baselineData,
                backgroundColor: "rgba(31, 55, 126, 0.5)",
                borderColor: "rgba(31, 55, 126, 1)",
                borderWidth: 1,
              },
              {
                label: "Proposed",
                data: proposedData,
                backgroundColor: "rgba(31, 55, 126, 0.9)",
                borderColor: "rgba(147, 182, 78, 1)",
                borderWidth: 1,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              title: {
                display: true,
                text: "Accumulated Purchase and Electricity Costs",
              },
            },
            scales: {
              y: {
                beginAtZero: true,
                title: {
                  display: true,
                  text: "Cost ($)",
                },
              },
            },
          },
        });
      }

      function drawCashflowChart(
        baselineInitial,
        proposedInitial,
        baselineAnnual,
        proposedAnnual
      ) {
        const ctx = document.getElementById("cashflow_div");
        if (!ctx) return;

        // Clear previous chart
        ctx.innerHTML = '<canvas id="cashflowChart"></canvas>';
        const canvas = document.getElementById("cashflowChart");

        const years = 11;
        const cashflowData = [];
        const labels = [];

        for (let i = 0; i < years; i++) {
          if (i === 0) {
            labels[i] = "Initial";
            cashflowData[i] = baselineInitial - proposedInitial;
          } else {
            labels[i] = `Year ${i}`;
            cashflowData[i] =
              cashflowData[i - 1] + (baselineAnnual - proposedAnnual);
          }
        }

        new Chart(canvas, {
          type: "bar",
          data: {
            labels: labels,
            datasets: [
              {
                label: "Cash Flow",
                data: cashflowData,
                backgroundColor: "rgba(31, 55, 126, 0.9)",
                borderColor: "rgba(147, 182, 78, 1)",
                borderWidth: 1,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              title: {
                display: true,
                text: "Accumulated Cash Flow",
              },
            },
            scales: {
              y: {
                beginAtZero: true,
                title: {
                  display: true,
                  text: "Cash Flow ($)",
                },
              },
            },
          },
        });
      }

      // Helper functions
      function formatCurrency(value) {
        return (
          "$" +
          value.toLocaleString("en-US", {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2,
          })
        );
      }

      function formatEnergy(value) {
        return (
          value.toLocaleString("en-US", {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2,
          }) + " kWh"
        );
      }

      function formatYears(value) {
        return value.toLocaleString("en-US", {
          minimumFractionDigits: 1,
          maximumFractionDigits: 1,
        });
      }

      function formatPercentage(value) {
        return (
          value.toLocaleString("en-US", {
            minimumFractionDigits: 1,
            maximumFractionDigits: 1,
          }) + "%"
        );
      }

      // Update display elements
      function updateDisplay(elementId, value) {
        const element = document.getElementById(elementId);
        if (element) {
          element.textContent = value;
        }
      }

      // Data persistence
      function saveData() {
        const data = {
          electricityRate: document.getElementById("electricityRate").value,
          operationHours: document.getElementById("operationHours").value,
          baselineQuantity: document.getElementById("baselineQuantity").value,
          baselineWatts: document.getElementById("baselineWatts").value,
          baselineCost: document.getElementById("baselineCost").value,
          baselineDescription: document.getElementById("baselineDescription")
            .value,
          baselineControlQty:
            document.getElementById("baselineControlQty")?.value || 0,
          baselineControlReduction:
            document.getElementById("baselineControlReduction")?.value || 0,
          baselineControlCost:
            document.getElementById("baselineControlCost")?.value || 0,
          baselineRebateDescription:
            document.getElementById("baselineRebateDescription")?.value || "",
          baselineRebateValue:
            document.getElementById("baselineRebateValue")?.value || "",
          proposedProduct: document.getElementById("proposedProduct").value,
          proposedQuantity: document.getElementById("proposedQuantity").value,
          proposedCost: document.getElementById("proposedCost").value,
          proposedDescription: document.getElementById("proposedDescription")
            .value,
          proposedControlQty:
            document.getElementById("proposedControlQty")?.value || 0,
          proposedControlReduction:
            document.getElementById("proposedControlReduction")?.value || 0,
          proposedControlCost:
            document.getElementById("proposedControlCost")?.value || 0,
          proposedRebateDescription:
            document.getElementById("proposedRebateDescription")?.value || "",
          proposedRebateValue:
            document.getElementById("proposedRebateValue")?.value || "",
          proposedLabourCost:
            document.getElementById("proposedLabourCost")?.value || 0,
        };
        localStorage.setItem("ledCalculatorData", JSON.stringify(data));
      }

      function loadSavedData() {
        const saved = localStorage.getItem("ledCalculatorData");
        if (saved) {
          try {
            const data = JSON.parse(saved);
            Object.keys(data).forEach((key) => {
              const element = document.getElementById(key);
              if (element && data[key] !== undefined) {
                element.value = data[key];
              }
            });

            [
              "baselineRebateValue",
              "proposedRebateValue",
              "baselineControlCost",
              "proposedControlCost",
              "proposedLabourCost",
            ].forEach((id) => {
              const el = document.getElementById(id);
              if (
                el &&
                (el.value === "" || el.value === null || el.value === undefined)
              ) {
                el.value = "0";
              }
            });

            if (data.proposedProduct) {
              updateProposedWatts();
            }

            if (
              data.baselineControlQty ||
              data.baselineControlReduction ||
              data.baselineControlCost
            ) {
              document.querySelectorAll(".control-fields").forEach((field) => {
                field.style.display = "block";
                field.classList.add("show");
              });
              document.querySelector(
                'button[onclick="toggleControls()"]'
              ).textContent = "Hide Control";
            }

            if (data.baselineRebateValue || data.proposedRebateValue) {
              document.querySelectorAll(".rebate-fields").forEach((field) => {
                field.style.display = "block";
                field.classList.add("show");
              });
              document.querySelector(
                'button[onclick="toggleRebates()"]'
              ).textContent = "Hide Rebate";
            }
          } catch (e) {
            console.error("Error loading saved data:", e);
          }
        }
      }

      // Tab functionality
      function showTab(tabName) {
        const tabs = document.querySelectorAll(".tab");
        tabs.forEach((tab) => tab.classList.remove("active"));

        const activeTab = event.target;
        activeTab.classList.add("active");

        // Show/hide appropriate chart
        const chartDiv = document.getElementById("chart_div");
        const cashflowDiv = document.getElementById("cashflow_div");

        if (tabName === "tenYear") {
          chartDiv.classList.add("active");
          cashflowDiv.classList.remove("active");
        } else if (tabName === "cashflow") {
          chartDiv.classList.remove("active");
          cashflowDiv.classList.add("active");
        }
      }

      // Control and Rebate Toggle Functions
      function toggleControls() {
        const controlFields = document.querySelectorAll(".control-fields");
        const controlBtn = event.target;

        controlFields.forEach((field) => {
          if (field.style.display === "none") {
            field.style.display = "block";
            field.classList.add("show");
          } else {
            field.style.display = "none";
            field.classList.remove("show");
          }
        });

        controlBtn.textContent =
          controlBtn.textContent === "Add Control"
            ? "Hide Control"
            : "Add Control";
        calculateAll();
      }

      function toggleRebates() {
        const rebateFields = document.querySelectorAll(".rebate-fields");
        const rebateBtn = event.target;

        rebateFields.forEach((field) => {
          if (field.style.display === "none") {
            field.style.display = "block";
            field.classList.add("show");
          } else {
            field.style.display = "none";
            field.classList.remove("show");
          }
        });

        rebateBtn.textContent =
          rebateBtn.textContent === "Add Rebate" ? "Hide Rebate" : "Add Rebate";
        calculateAll();
      }

      // Action buttons
      function addControl() {
        alert(
          "Add Control functionality - This would integrate with your control system to provide more accurate energy savings calculations."
        );
      }

      function addRebate() {
        alert(
          "Add Rebate functionality - This would allow users to input available rebates and incentives to improve ROI calculations."
        );
      }

      function printResults() {
        window.print();
      }

      function showDisclaimer() {
        alert(
          "Disclaimer: This calculator provides estimates based on the information provided. Weather, temperature, hours of usage and other factors can have an impact on precise costs. Your results may vary, and Grizzly Lighting cannot be held responsible for the accuracy of estimated costs or ROI. Under all circumstances, our liability is limited to that described in our products' warranties."
        );
      }

      // Input validation
      function validateInput(input) {
        const value = parseFloat(input.value);
        if (value < 0) {
          input.value = 0;
        }
        calculateAll();
      }

      document.addEventListener("input", function (e) {
        if (e.target.type === "number") {
          validateInput(e.target);
        }
      });

      document.addEventListener("input", function (e) {
        if (
          e.target.id &&
          (e.target.id.includes("Control") || e.target.id.includes("Rebate"))
        ) {
          calculateAll();
        }
      });
    </script>
  </body>
  <!-- Footer Disclaimer -->
  <div class="footer" role="contentinfo" aria-label="Disclaimer">
    <div class="disclaimer" role="note">
      <div class="disclaimer-icon">!</div>
      <div class="disclaimer-content">
        <div class="disclaimer-title">Disclaimer</div>
        <p>
          Results are based on information available to us at the time of
          calculation. Weather, temperature, hours of usage and other factors
          can have an impact on precise costs. Your results may vary, and
          Grizzly Lighting cannot be held responsible for the accuracy of
          estimated costs or ROI. Under all circumstances, our liability is
          limited to that described in our products' warranties.
        </p>
      </div>
    </div>
  </div>
</html>
