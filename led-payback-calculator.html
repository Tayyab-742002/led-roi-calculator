<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Visual Simple Economic Tool</title>
    <style>
      /* CSS Reset and Base Styles */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      :root {
        --primary-color: #1c367e;
        --secondary-color: #38a169;
        --accent-color: #3182ce;
        --background-color: #f8f9fa;
        --surface-color: #ffffff;
        --text-primary: #333333;
        --text-secondary: #6c757d;
        --border-color: #dee2e6;
        --shadow-light: 0 2px 8px rgba(0, 0, 0, 0.1);
        --shadow-medium: 0 4px 16px rgba(0, 0, 0, 0.15);
        --border-radius: 8px;
        --transition: all 0.3s ease;
        --spacing-xs: 0.5rem;
        --spacing-sm: 1rem;
        --spacing-md: 1.5rem;
        --spacing-lg: 2rem;
        --spacing-xl: 3rem;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: var(--background-color);
        color: var(--text-primary);
        line-height: 1.6;
        min-height: 100vh;
        font-size: 16px;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: var(--spacing-xs);
      }

      /* Header Styles */
      .header {
        background: linear-gradient(
          135deg,
          var(--surface-color) 0%,
          #f8f9fa 100%
        );
        color: var(--text-primary);
        padding: var(--spacing-sm);
        border-radius: var(--border-radius);
        margin-bottom: var(--spacing-sm);
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: var(--spacing-sm);
        border: 1px solid var(--border-color);
        box-shadow: var(--shadow-light);
      }

      .header-left {
        display: flex;
        align-items: center;
        gap: var(--spacing-md);
        flex-wrap: wrap;
      }

      .logo {
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
      }

      .logo img {
        height: 50px;
        width: auto;
        filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
      }

      .header h1 {
        font-size: clamp(1.2rem, 3vw, 2rem);
        font-weight: 300;
        margin: 0;
        color: var(--text-primary);
        line-height: 1.2;
      }

      .header-buttons {
        display: flex;
        gap: var(--spacing-sm);
        flex-wrap: wrap;
        align-items: center;
      }

      .btn {
        padding: 0.5rem 1rem;
        border: none;
        border-radius: var(--border-radius);
        cursor: pointer;
        font-weight: 600;
        font-size: 0.8rem;
        transition: var(--transition);
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        white-space: nowrap;
        min-height: 36px;
      }

      .btn-primary {
        background: linear-gradient(135deg, #e4efc0 0%, #abbd73 100%);
        color: var(--text-primary);
        box-shadow: var(--shadow-light);
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-medium);
      }

      .btn-secondary {
        background: var(--surface-color);
        color: var(--text-primary);
        border: 1px solid var(--border-color);
      }

      .btn-secondary:hover {
        background: #e9ecef;
        border-color: #adb5bd;
        transform: translateY(-1px);
      }

      /* General Inputs Section */
      .general-inputs {
        background: var(--surface-color);
        padding: var(--spacing-sm);
        border-radius: var(--border-radius);
        margin-bottom: var(--spacing-sm);
        box-shadow: var(--shadow-light);
        border: 1px solid var(--border-color);
      }

      .general-inputs h2 {
        color: var(--text-primary);
        margin-bottom: var(--spacing-sm);
        font-size: 1.2rem;
        font-weight: 600;
      }

      .input-group {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: var(--spacing-sm);
        align-items: end;
      }

      .input-field {
        display: flex;
        flex-direction: row;
        align-items: center;
        gap: var(--spacing-xs);
      }

      .input-field label {
        font-weight: 600;
        color: var(--text-primary);
        font-size: 0.8rem;
        min-width: 120px;
        flex-shrink: 0;
      }

      .input-field input {
        padding: 0.5rem;
        border: 1px solid var(--border-color);
        border-radius: var(--border-radius);
        font-size: 0.9rem;
        transition: var(--transition);
        background: var(--surface-color);
        flex: 1;
      }

      .input-field input:focus {
        outline: none;
        border-color: var(--accent-color);
        box-shadow: 0 0 0 3px rgba(56, 130, 206, 0.1);
      }

      .unit-label {
        background: var(--text-secondary);
        color: white;
        padding: 0.5rem 0.75rem;
        border-radius: var(--border-radius);
        font-weight: 600;
        font-size: 0.8rem;
        text-align: center;
        white-space: nowrap;
        align-self: center;
      }

      /* Comparison Sections */
      .comparison-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
        gap: var(--spacing-sm);
        margin-bottom: var(--spacing-sm);
      }

      .comparison-section {
        background: var(--surface-color);
        padding: var(--spacing-sm);
        border-radius: var(--border-radius);
        box-shadow: var(--shadow-light);
        border: 1px solid var(--border-color);
      }

      .comparison-section h2 {
        color: var(--text-primary);
        margin-bottom: var(--spacing-sm);
        font-size: 1.2rem;
        text-align: left;
        font-weight: 600;
      }

      .baseline h2 {
        color: var(--accent-color);
      }

      .proposed h2 {
        color: var(--secondary-color);
      }

      .form-group {
        margin-bottom: var(--spacing-sm);
        display: flex;
        flex-direction: row;
        align-items: center;
        gap: var(--spacing-xs);
      }

      .form-group label {
        font-weight: 600;
        color: var(--text-primary);
        font-size: 0.8rem;
        min-width: 140px;
        flex-shrink: 0;
      }

      .form-group input,
      .form-group select {
        padding: 0.5rem;
        border: 1px solid var(--border-color);
        border-radius: var(--border-radius);
        font-size: 0.9rem;
        transition: var(--transition);
        background: var(--surface-color);
        flex: 1;
      }

      .form-group input:focus,
      .form-group select:focus {
        outline: none;
        border-color: var(--accent-color);
        box-shadow: 0 0 0 3px rgba(56, 130, 206, 0.1);
      }

      /* Results Display */
      .results {
        color: white;
        padding: var(--spacing-sm);
        border-radius: var(--border-radius);
        margin-top: var(--spacing-sm);
        box-shadow: 0 4px 12px rgba(13, 110, 253, 0.3);
      }

      .results h3 {
        margin-bottom: var(--spacing-sm);
        color: black;
        font-size: 1rem;
        font-weight: 700;
      }

      .result-item {
        background: rgba(112, 181, 252, 0.9);
        display: flex;
        justify-content: space-between;
        padding: var(--spacing-sm);
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 4px;
        margin-bottom: var(--spacing-xs);
      }

      .result-item:last-child {
        margin-bottom: 0;
      }

      .result-label {
        font-weight: 600;
        opacity: 0.9;
        color: black;
      }

      .result-value {
        font-weight: bold;
        font-size: 1rem;
      }

      .proposed .results {
        color: black;
        box-shadow: 0 4px 12px rgba(25, 135, 84, 0.3);
      }

      .proposed .result-item {
        background: #d4e1ab;
      }
      /* Savings Section */
      .savings-section {
        background: var(--surface-color);
        padding: var(--spacing-md);
        border-radius: var(--border-radius);
        margin-bottom: var(--spacing-sm);
        box-shadow: var(--shadow-light);
        text-align: center;
        border: 1px solid var(--border-color);
      }

      .savings-section h2 {
        margin-bottom: var(--spacing-sm);
        font-size: clamp(1.2rem, 3vw, 1.5rem);
        font-weight: 700;
        color: var(--text-primary);
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      .savings-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: var(--spacing-sm);
        margin-top: var(--spacing-sm);
      }

      .savings-item {
        background: var(--surface-color);
        padding: var(--spacing-sm);
        border-radius: var(--border-radius);
        border: 1px solid var(--border-color);
        box-shadow: var(--shadow-light);
        transition: var(--transition);
      }

      .savings-item:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-medium);
      }

      .savings-value {
        font-size: clamp(1.2rem, 4vw, 2rem);
        font-weight: 800;
        margin-bottom: var(--spacing-xs);
        color: var(--accent-color);
      }

      .savings-label {
        font-size: 0.8rem;
        color: var(--text-secondary);
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      /* Chart Container */
      .chart-container {
        background: #f8f9fa;
        padding: 25px;
        border-radius: 8px;
        margin-bottom: 25px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        border: 2px solid #e9ecef;
      }

      .chart-content {
        margin-top: 25px;
      }

      .chart-div {
        display: none;
        min-height: 400px;
        background: white;
        border: 2px solid #dee2e6;
        border-radius: 8px;
        padding: 25px;
        text-align: center;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .chart-div.active {
        display: block;
      }

      .chart-div canvas {
        max-width: 100%;
        height: auto;
      }

      /* Control and Rebate Fields */
      .control-fields,
      .rebate-fields {
        transition: all 0.3s ease;
        opacity: 0;
        transform: translateY(-5px);
      }

      .control-fields.show,
      .rebate-fields.show {
        opacity: 1;
        transform: translateY(0);
      }

      .tabs {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin-bottom: 25px;
      }

      .tab {
        padding: 12px 24px;
        background: white;
        border: 2px solid #dee2e6;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 600;
        font-size: 14px;
        transition: all 0.3s ease;
        color: #495057;
      }

      .tab.active {
        background: #0d6efd;
        color: white;
        border-color: #0d6efd;
        box-shadow: 0 2px 8px rgba(13, 110, 253, 0.3);
      }

      .tab:hover:not(.active) {
        background: #f8f9fa;
        border-color: #0d6efd;
        color: #0d6efd;
      }

      /* Footer */
      .footer {
        background: #f8f9fa;
        padding: 25px;
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        text-align: center;
        border: 2px solid #e9ecef;
      }

      .disclaimer {
        color: #495057;
        font-size: 1rem;
        line-height: 1.6;
        font-weight: 500;
      }

      .disclaimer a {
        color: #0d6efd;
        text-decoration: none;
        font-weight: 600;
        transition: color 0.3s ease;
      }

      .disclaimer a:hover {
        color: #0b5ed7;
        text-decoration: underline;
      }

      /* Responsive Design */
      @media (max-width: 1200px) {
        .container {
          max-width: 100%;
          padding: var(--spacing-sm);
        }
      }

      @media (max-width: 768px) {
        .header {
          flex-direction: column;
          text-align: center;
          gap: var(--spacing-md);
          padding: var(--spacing-sm);
        }

        .header-left {
          justify-content: center;
          flex-direction: column;
          gap: var(--spacing-sm);
        }

        .header-buttons {
          justify-content: center;
          width: 100%;
        }

        .btn {
          flex: 1;
          min-width: 120px;
        }

        .input-group {
          grid-template-columns: 1fr;
          gap: var(--spacing-md);
        }

        .unit-label {
          align-self: center;
          width: fit-content;
        }

        .comparison-container {
          grid-template-columns: 1fr;
          gap: var(--spacing-md);
        }

        .comparison-section {
          padding: var(--spacing-md);
        }

        .savings-grid {
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
          gap: var(--spacing-md);
        }

        .savings-section {
          padding: var(--spacing-lg);
        }
      }

      @media (max-width: 480px) {
        .container {
          padding: var(--spacing-xs);
        }

        .header {
          padding: var(--spacing-sm);
        }

        .logo img {
          height: 40px;
          width: auto;
        }

        .btn {
          padding: 0.5rem 1rem;
          font-size: 0.8rem;
          min-height: 40px;
        }

        .general-inputs,
        .comparison-section,
        .savings-section {
          padding: var(--spacing-sm);
        }

        .savings-grid {
          grid-template-columns: 1fr;
        }

        .form-group {
          margin-bottom: var(--spacing-sm);
        }
      }

      /* Accessibility Improvements */
      @media (prefers-reduced-motion: reduce) {
        * {
          animation-duration: 0.01ms !important;
          animation-iteration-count: 1 !important;
          transition-duration: 0.01ms !important;
        }
      }

      /* Focus Management */
      .btn:focus,
      input:focus,
      select:focus {
        outline: 2px solid var(--accent-color);
        outline-offset: 2px;
      }

      /* Print Styles */
      @media print {
        .header-buttons,
        .btn {
          display: none;
        }

        .container {
          max-width: none;
          padding: 0;
        }

        .comparison-container {
          grid-template-columns: 1fr 1fr;
        }

        .comparison-section,
        .general-inputs,
        .savings-section,
        .footer,
        .chart-container {
          box-shadow: none;
          border: 1px solid #ddd;
          margin-bottom: 15px;
          break-inside: avoid;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- Header -->
      <div class="header">
        <div class="header-left">
          <div class="logo">
            <img
              src="https://www.grizzlylighting.ca/web/image/15772-3fcaf0d5/GRIZZLY.webp"
              alt="Grizzly Lighting Systems Logo"
            />
          </div>
          <h1>Simple Economic Tool</h1>
        </div>
        <div class="header-buttons">
          <button class="btn btn-primary" onclick="toggleControls()">
            Add Control
          </button>
          <button class="btn btn-primary" onclick="toggleRebates()">
            Add Rebate
          </button>
          <button class="btn btn-secondary" onclick="printResults()">
            Print
          </button>
        </div>
      </div>

      <!-- General Inputs -->
      <div class="general-inputs">
        <h2>General Parameters</h2>
        <div class="input-group">
          <div class="input-field">
            <label for="electricityRate">Electricity Rate</label>
            <input
              type="number"
              id="electricityRate"
              value="10"
              min="0"
              step="0.01"
              onchange="calculateAll()"
            />
          </div>
          <div class="unit-label">kWh</div>

          <div class="input-field">
            <label for="operationHours">Operation Hours</label>
            <input
              type="number"
              id="operationHours"
              value="12"
              min="0"
              max="24"
              step="0.5"
              onchange="calculateAll()"
            />
          </div>
          <div class="unit-label">day</div>
        </div>
      </div>

      <!-- Comparison Sections -->
      <div class="comparison-container">
        <!-- Baseline Section -->
        <div class="comparison-section baseline">
          <h2>Baseline</h2>
          <div class="form-group">
            <label for="baselineDescription">Description/Catalog</label>
            <input
              type="text"
              id="baselineDescription"
              value="Test"
              placeholder="Enter current lighting description"
              onchange="calculateAll()"
            />
          </div>
          <div class="form-group">
            <label for="baselineQuantity">Quantity</label>
            <input
              type="number"
              id="baselineQuantity"
              value="10"
              min="0"
              onchange="calculateAll()"
            />
          </div>
          <div class="form-group">
            <label for="baselineWatts">Watts Per Luminaire</label>
            <input
              type="number"
              id="baselineWatts"
              value="70"
              min="0"
              onchange="calculateAll()"
            />
          </div>
          <div class="form-group">
            <label for="baselineCost">Cost Per Luminaire</label>
            <input
              type="number"
              id="baselineCost"
              value="12"
              min="0"
              step="0.01"
              onchange="calculateAll()"
            />
          </div>

          <!-- Control Fields (Hidden by default) -->
          <h3
            style="
              margin-top: 25px;
              margin-bottom: 20px;
              color: #495057;
              font-size: 1rem;
              font-weight: 700;
              text-transform: uppercase;
              letter-spacing: 0.5px;
              border-bottom: 2px solid #dee2e6;
              padding-bottom: 10px;
            "
          >
            Lighting Control
          </h3>
          <div class="form-group control-fields" style="display: none">
            <label for="baselineControlQty">Control Quantity</label>
            <input
              type="number"
              id="baselineControlQty"
              value="12"
              min="0"
              onchange="calculateAll()"
            />
          </div>
          <div class="form-group control-fields" style="display: none">
            <label for="baselineControlReduction">Control Reduction (%)</label>
            <input
              type="number"
              id="baselineControlReduction"
              value="1"
              min="0"
              max="100"
              onchange="calculateAll()"
            />
          </div>
          <div class="form-group control-fields" style="display: none">
            <label for="baselineControlCost">Control Cost</label>
            <input
              type="number"
              id="baselineControlCost"
              value="1"
              min="0"
              step="0.01"
              onchange="calculateAll()"
            />
          </div>

          <!-- Rebate Fields (Hidden by default) -->
          <h3
            style="
              margin-top: 25px;
              margin-bottom: 20px;
              color: #495057;
              font-size: 1.3rem;
              font-weight: 700;
              text-transform: uppercase;
              letter-spacing: 0.5px;
              border-bottom: 2px solid #dee2e6;
              padding-bottom: 10px;
            "
          >
            Rebates/Incidental Costs
          </h3>
          <div class="form-group rebate-fields" style="display: none">
            <label for="baselineRebateDescription">Rebate Description</label>
            <input
              type="text"
              id="baselineRebateDescription"
              placeholder="Enter rebate description"
              onchange="calculateAll()"
            />
          </div>
          <div class="form-group rebate-fields" style="display: none">
            <label for="baselineRebateValue">Rebate Value</label>
            <input
              type="text"
              id="baselineRebateValue"
              value="500"
              placeholder="Enter rebate value or calculation (e.g., 100 or 0.1*x)"
              onchange="calculateAll()"
            />
          </div>

          <!-- Baseline Results -->
          <div class="results">
            <h3>Baseline Results</h3>
            <div class="result-item">
              <span class="result-label">Initial Cost:</span>
              <span class="result-value" id="baselineInitialCost">$0</span>
            </div>
            <div class="result-item">
              <span class="result-label">Annual Energy Usage:</span>
              <span class="result-value" id="baselineAnnualEnergy"
                >0.00 kWh</span
              >
            </div>
            <div class="result-item">
              <span class="result-label">Annual Cost:</span>
              <span class="result-value" id="baselineAnnualCost">$0</span>
            </div>
          </div>
        </div>

        <!-- Proposed Section -->
        <div class="comparison-section proposed">
          <h2>Proposed</h2>
          <div class="form-group">
            <label for="proposedProduct">Product Selection</label>
            <select id="proposedProduct" onchange="updateProposedWatts()">
              <option value="">Select a product...</option>
              <!-- Product options will be populated by JavaScript -->
            </select>
          </div>
          <!-- <div class="form-group">
            <label for="proposedDescription">Description/Catalog</label>
            <input
              type="text"
              id="proposedDescription"
              placeholder="Product description"
              readonly
            />
          </div> -->
          <div class="form-group">
            <label for="proposedQuantity">Quantity</label>
            <input
              type="number"
              id="proposedQuantity"
              value="10"
              min="0"
              onchange="calculateAll()"
            />
          </div>
          <div class="form-group">
            <label for="proposedWatts">Watts Per Luminaire</label>
            <input
              type="number"
              id="proposedWatts"
              value="70"
              min="0"
              readonly
            />
          </div>
          <div class="form-group">
            <label for="proposedCost">Cost Per Luminaire</label>
            <input
              type="number"
              id="proposedCost"
              value="12"
              min="0"
              step="0.01"
              onchange="calculateAll()"
            />
          </div>

          <!-- Control Fields (Hidden by default) -->
          <h3
            style="
              margin-top: 25px;
              margin-bottom: 20px;
              color: #495057;
              font-size: 1rem;
              font-weight: 700;
              text-transform: uppercase;
              letter-spacing: 0.5px;
              border-bottom: 2px solid #dee2e6;
              padding-bottom: 10px;
            "
          >
            Lighting Control
          </h3>
          <div class="form-group control-fields" style="display: none">
            <label for="proposedControlQty">Control Quantity</label>
            <input
              type="number"
              id="proposedControlQty"
              value="12"
              min="0"
              onchange="calculateAll()"
            />
          </div>
          <div class="form-group control-fields" style="display: none">
            <label for="proposedControlReduction">Control Reduction (%)</label>
            <input
              type="number"
              id="proposedControlReduction"
              value="0"
              min="0"
              max="100"
              onchange="calculateAll()"
            />
          </div>
          <div class="form-group control-fields" style="display: none">
            <label for="proposedControlCost">Control Cost</label>
            <input
              type="number"
              id="proposedControlCost"
              value="0"
              min="0"
              step="0.01"
              onchange="calculateAll()"
            />
          </div>

          <!-- Rebate Fields (Hidden by default) -->
          <h3
            style="
              margin-top: 25px;
              margin-bottom: 20px;
              color: #495057;
              font-size: 1.3rem;
              font-weight: 700;
              text-transform: uppercase;
              letter-spacing: 0.5px;
              border-bottom: 2px solid #dee2e6;
              padding-bottom: 10px;
            "
          >
            Rebates/Incidental Costs
          </h3>
          <div class="form-group rebate-fields" style="display: none">
            <label for="proposedRebateDescription">Rebate Description</label>
            <input
              type="text"
              id="proposedRebateDescription"
              placeholder="Enter rebate description"
              onchange="calculateAll()"
            />
          </div>
          <div class="form-group rebate-fields" style="display: none">
            <label for="proposedRebateValue">Rebate Value</label>
            <input
              type="text"
              id="proposedRebateValue"
              value="500"
              placeholder="Enter rebate value or calculation (e.g., 100 or 0.1*x)"
              onchange="calculateAll()"
            />
          </div>

          <!-- Proposed Results -->
          <div class="results">
            <h3>Proposed Results</h3>
            <div class="result-item">
              <span class="result-label">Initial Cost:</span>
              <span class="result-value" id="proposedInitialCost">$0</span>
            </div>
            <div class="result-item">
              <span class="result-label">Annual Energy Usage:</span>
              <span class="result-value" id="proposedAnnualEnergy"
                >0.00 kWh</span
              >
            </div>
            <div class="result-item">
              <span class="result-label">Annual Cost:</span>
              <span class="result-value" id="proposedAnnualCost">$0</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Savings Section -->
      <div class="savings-section">
        <h2>Economic Analysis</h2>
        <div class="savings-grid">
          <div class="savings-item">
            <div class="savings-value" id="annualSavings">$0</div>
            <div class="savings-label">Annual Savings</div>
          </div>
          <div class="savings-item">
            <div class="savings-value" id="paybackPeriod">0.0</div>
            <div class="savings-label">Payback Period (Years)</div>
          </div>
          <div class="savings-item">
            <div class="savings-value" id="roiPercentage">0%</div>
            <div class="savings-label">ROI</div>
          </div>
          <div class="savings-item">
            <div class="savings-value" id="tenYearSavings">$0</div>
            <div class="savings-label">10-Year Savings</div>
          </div>
        </div>
      </div>

      <!-- Chart Container -->
      <div class="chart-container">
        <div class="tabs">
          <button class="tab active" onclick="showTab('tenYear')">
            10 Year
          </button>
          <button class="tab" onclick="showTab('cashflow')">Cashflow</button>
        </div>
        <div class="chart-content">
          <div id="chart_div" class="chart-div active"></div>
          <div id="cashflow_div" class="chart-div"></div>
        </div>
      </div>
    </div>

    <!-- Chart.js for charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
      // Product Catalog Data
      const productCatalog = [
        // Tundra Area Light Series
        {
          id: "tundra-70",
          name: "Tundra Area Light - 70 Watt",
          watts: 70,
          category: "Tundra Area Light",
        },
        {
          id: "tundra-100",
          name: "Tundra Area Light - 100 Watt",
          watts: 100,
          category: "Tundra Area Light",
        },
        {
          id: "tundra-150",
          name: "Tundra Area Light - 150 Watt",
          watts: 150,
          category: "Tundra Area Light",
        },
        {
          id: "tundra-200",
          name: "Tundra Area Light - 200 Watt",
          watts: 200,
          category: "Tundra Area Light",
        },
        {
          id: "tundra-240",
          name: "Tundra Area Light - 240 Watt",
          watts: 240,
          category: "Tundra Area Light",
        },
        {
          id: "tundra-300",
          name: "Tundra Area Light - 300 Watt",
          watts: 300,
          category: "Tundra Area Light",
        },

        // Orbix Round UFO Light Series
        {
          id: "orbix-70",
          name: "Orbix Round UFO Light - 70 Watt",
          watts: 70,
          category: "Orbix Round UFO Light",
        },
        {
          id: "orbix-100",
          name: "Orbix Round UFO Light - 100 Watt",
          watts: 100,
          category: "Orbix Round UFO Light",
        },
        {
          id: "orbix-150",
          name: "Orbix Round UFO Light - 150 Watt",
          watts: 150,
          category: "Orbix Round UFO Light",
        },
        {
          id: "orbix-180",
          name: "Orbix Round UFO Light - 180 Watt",
          watts: 180,
          category: "Orbix Round UFO Light",
        },
        {
          id: "orbix-200",
          name: "Orbix Round UFO Light - 200 Watt",
          watts: 200,
          category: "Orbix Round UFO Light",
        },
        {
          id: "orbix-240",
          name: "Orbix Round UFO Light - 240 Watt",
          watts: 240,
          category: "Orbix Round UFO Light",
        },

        // Alpine LED Wall Pack Light Series
        {
          id: "alpine-80",
          name: "Alpine LED Wall Pack Light - 80 Watt",
          watts: 80,
          category: "Alpine LED Wall Pack Light",
        },
        {
          id: "alpine-100",
          name: "Alpine LED Wall Pack Light - 100 Watt",
          watts: 100,
          category: "Alpine LED Wall Pack Light",
        },
        {
          id: "alpine-120",
          name: "Alpine LED Wall Pack Light - 120 Watt",
          watts: 120,
          category: "Alpine LED Wall Pack Light",
        },

        // Raven Backlit Flat Panel Light 2x4 Series
        {
          id: "raven-2x4-30",
          name: "Raven Backlit Flat Panel Light 2x4 - 30 Watt",
          watts: 30,
          category: "Raven Backlit Flat Panel Light 2x4",
        },
        {
          id: "raven-2x4-40",
          name: "Raven Backlit Flat Panel Light 2x4 - 40 Watt",
          watts: 40,
          category: "Raven Backlit Flat Panel Light 2x4",
        },
        {
          id: "raven-2x4-50",
          name: "Raven Backlit Flat Panel Light 2x4 - 50 Watt",
          watts: 50,
          category: "Raven Backlit Flat Panel Light 2x4",
        },
        {
          id: "raven-2x4-60",
          name: "Raven Backlit Flat Panel Light 2x4 - 60 Watt",
          watts: 60,
          category: "Raven Backlit Flat Panel Light 2x4",
        },
        {
          id: "raven-2x4-72",
          name: "Raven Backlit Flat Panel Light 2x4 - 72 Watt",
          watts: 72,
          category: "Raven Backlit Flat Panel Light 2x4",
        },

        // Raven Backlit Flat Panel Light 2x2/1x4 Series
        {
          id: "raven-2x2-15",
          name: "Raven Backlit Flat Panel Light 2x2/1x4 - 15 Watt",
          watts: 15,
          category: "Raven Backlit Flat Panel Light 2x2/1x4",
        },
        {
          id: "raven-2x2-20",
          name: "Raven Backlit Flat Panel Light 2x2/1x4 - 20 Watt",
          watts: 20,
          category: "Raven Backlit Flat Panel Light 2x2/1x4",
        },
        {
          id: "raven-2x2-25",
          name: "Raven Backlit Flat Panel Light 2x2/1x4 - 25 Watt",
          watts: 25,
          category: "Raven Backlit Flat Panel Light 2x2/1x4",
        },
        {
          id: "raven-2x2-30",
          name: "Raven Backlit Flat Panel Light 2x2/1x4 - 30 Watt",
          watts: 30,
          category: "Raven Backlit Flat Panel Light 2x2/1x4",
        },
        {
          id: "raven-2x2-40",
          name: "Raven Backlit Flat Panel Light 2x2/1x4 - 40 Watt",
          watts: 40,
          category: "Raven Backlit Flat Panel Light 2x2/1x4",
        },
      ];

      // Initialize the calculator
      document.addEventListener("DOMContentLoaded", function () {
        populateProductDropdown();
        loadSavedData();

        document.querySelectorAll(".control-fields").forEach((field) => {
          field.style.display = "block";
          field.classList.add("show");
        });
        document.querySelectorAll(".rebate-fields").forEach((field) => {
          field.style.display = "block";
          field.classList.add("show");
        });

        // Update button text
        document.querySelector(
          'button[onclick="toggleControls()"]'
        ).textContent = "Hide Control";
        document.querySelector(
          'button[onclick="toggleRebates()"]'
        ).textContent = "Hide Rebate";

        setTimeout(() => {
          const select = document.getElementById("proposedProduct");
          select.value = "tundra-70";
          updateProposedWatts();
        }, 100);

        calculateAll();
      });

      function populateProductDropdown() {
        const select = document.getElementById("proposedProduct");
        select.innerHTML = '<option value="">Select a product...</option>';

        const categories = {};
        productCatalog.forEach((product) => {
          if (!categories[product.category]) {
            categories[product.category] = [];
          }
          categories[product.category].push(product);
        });

        Object.keys(categories).forEach((category) => {
          const optgroup = document.createElement("optgroup");
          optgroup.label = category;

          categories[category].forEach((product) => {
            const option = document.createElement("option");
            option.value = product.id;
            option.textContent = product.name;
            optgroup.appendChild(option);
          });

          select.appendChild(optgroup);
        });
      }

      function updateProposedWatts() {
        const select = document.getElementById("proposedProduct");
        const wattsInput = document.getElementById("proposedWatts");
        const descriptionInput = document.getElementById("proposedDescription");

        if (select.value) {
          const selectedProduct = productCatalog.find(
            (p) => p.id === select.value
          );
          if (selectedProduct) {
            wattsInput.value = selectedProduct.watts;
            descriptionInput.value = selectedProduct.name;
          }
        } else {
          wattsInput.value = "";
          descriptionInput.value = "";
        }

        calculateAll();
      }

      function calculateAll() {
        // Get input values
        const electricityRate =
          parseFloat(document.getElementById("electricityRate").value) || 0;
        const operationHours =
          parseFloat(document.getElementById("operationHours").value) || 0;

        // Baseline calculations
        const baselineQuantity =
          parseInt(document.getElementById("baselineQuantity").value) || 0;
        const baselineWatts =
          parseFloat(document.getElementById("baselineWatts").value) || 0;
        const baselineCost =
          parseFloat(document.getElementById("baselineCost").value) || 0;

        const baselineControlQty =
          parseFloat(document.getElementById("baselineControlQty")?.value) || 0;
        const baselineControlReduction =
          parseFloat(
            document.getElementById("baselineControlReduction")?.value
          ) || 0;
        const baselineControlCost =
          parseFloat(document.getElementById("baselineControlCost")?.value) ||
          0;
        const baselineRebateValue = parseRebateValue(
          document.getElementById("baselineRebateValue")?.value
        );

        // Proposed calculations
        const proposedQuantity =
          parseInt(document.getElementById("proposedQuantity").value) || 0;
        const proposedWatts =
          parseFloat(document.getElementById("proposedWatts").value) || 0;
        const proposedCost =
          parseFloat(document.getElementById("proposedCost").value) || 0;

        const proposedControlQty =
          parseFloat(document.getElementById("proposedControlQty")?.value) || 0;
        const proposedControlReduction =
          parseFloat(
            document.getElementById("proposedControlReduction")?.value
          ) || 0;
        const proposedControlCost =
          parseFloat(document.getElementById("proposedControlCost")?.value) ||
          0;
        const proposedRebateValue = parseRebateValue(
          document.getElementById("proposedRebateValue")?.value
        );

        // Calculate baseline metrics with controls
        let baselineAnnualEnergy =
          (baselineQuantity * baselineWatts * operationHours * 365) / 1000;
        if (baselineControlQty > 0 && baselineControlReduction > 0) {
          baselineAnnualEnergy =
            baselineAnnualEnergy * (1 - baselineControlReduction / 100);
        }
        const baselineAnnualCost =
          baselineAnnualEnergy * (electricityRate / 100);
        let baselineInitialCost = baselineQuantity * baselineCost;
        if (baselineControlQty > 0 && baselineControlCost > 0) {
          baselineInitialCost += baselineControlQty * baselineControlCost;
        }
        if (baselineRebateValue > 0) {
          baselineInitialCost -= baselineRebateValue;
        }

        // Calculate proposed metrics with controls
        let proposedAnnualEnergy =
          (proposedQuantity * proposedWatts * operationHours * 365) / 1000;
        if (proposedControlQty > 0 && proposedControlReduction > 0) {
          proposedAnnualEnergy =
            proposedAnnualEnergy * (1 - proposedControlReduction / 100);
        }
        const proposedAnnualCost =
          proposedAnnualEnergy * (electricityRate / 100);
        let proposedInitialCost = proposedQuantity * proposedCost;
        if (proposedControlQty > 0 && proposedControlCost > 0) {
          proposedInitialCost += proposedControlQty * proposedControlCost;
        }
        if (proposedRebateValue > 0) {
          proposedInitialCost -= proposedRebateValue;
        }

        // Calculate savings and ROI
        const annualSavings = baselineAnnualCost - proposedAnnualCost;
        const paybackPeriod =
          proposedInitialCost > 0 && annualSavings > 0
            ? proposedInitialCost / annualSavings
            : 0;
        const roiPercentage =
          proposedInitialCost > 0
            ? (annualSavings / proposedInitialCost) * 100
            : 0;
        const tenYearSavings = annualSavings * 10;

        // Update display
        updateDisplay(
          "baselineInitialCost",
          formatCurrency(baselineInitialCost)
        );
        updateDisplay(
          "baselineAnnualEnergy",
          formatEnergy(baselineAnnualEnergy)
        );
        updateDisplay("baselineAnnualCost", formatCurrency(baselineAnnualCost));

        updateDisplay(
          "proposedInitialCost",
          formatCurrency(proposedInitialCost)
        );
        updateDisplay(
          "proposedAnnualEnergy",
          formatEnergy(proposedAnnualEnergy)
        );
        updateDisplay("proposedAnnualCost", formatCurrency(proposedAnnualCost));

        updateDisplay("annualSavings", formatCurrency(annualSavings));
        updateDisplay("paybackPeriod", formatYears(paybackPeriod));
        updateDisplay("roiPercentage", formatPercentage(roiPercentage));
        updateDisplay("tenYearSavings", formatCurrency(tenYearSavings));

        // Draw charts
        drawCharts(
          baselineInitialCost,
          proposedInitialCost,
          baselineAnnualCost,
          proposedAnnualCost
        );

        // Save data
        saveData();
      }

      function parseRebateValue(value) {
        if (!value || value === "") return 0;

        try {
          // Replace 'x' with '*' for multiplication
          const expression = value.replace(/x/g, "*");
          const result = eval(expression);
          return isNaN(result) ? 0 : parseFloat(result);
        } catch (e) {
          return 0;
        }
      }

      // Chart drawing functions
      function drawCharts(
        baselineInitial,
        proposedInitial,
        baselineAnnual,
        proposedAnnual
      ) {
        drawTenYearChart(
          baselineInitial,
          proposedInitial,
          baselineAnnual,
          proposedAnnual
        );
        drawCashflowChart(
          baselineInitial,
          proposedInitial,
          baselineAnnual,
          proposedAnnual
        );
      }

      function drawTenYearChart(
        baselineInitial,
        proposedInitial,
        baselineAnnual,
        proposedAnnual
      ) {
        const ctx = document.getElementById("chart_div");
        if (!ctx) return;

        // Clear previous chart
        ctx.innerHTML = '<canvas id="tenYearChart"></canvas>';
        const canvas = document.getElementById("tenYearChart");

        const years = 11;
        const baselineData = [];
        const proposedData = [];
        const labels = [];

        for (let i = 0; i < years; i++) {
          if (i === 0) {
            labels[i] = "Initial";
            baselineData[i] = baselineInitial;
            proposedData[i] = proposedInitial;
          } else {
            labels[i] = `Year ${i}`;
            baselineData[i] = baselineData[i - 1] + baselineAnnual;
            proposedData[i] = proposedData[i - 1] + proposedAnnual;
          }
        }

        new Chart(canvas, {
          type: "bar",
          data: {
            labels: labels,
            datasets: [
              {
                label: "Baseline",
                data: baselineData,
                backgroundColor: "rgba(48, 118, 185, 0.8)",
                borderColor: "rgba(48, 118, 185, 1)",
                borderWidth: 1,
              },
              {
                label: "Proposed",
                data: proposedData,
                backgroundColor: "rgba(147, 182, 78, 0.8)",
                borderColor: "rgba(147, 182, 78, 1)",
                borderWidth: 1,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              title: {
                display: true,
                text: "Accumulated Purchase and Electricity Costs",
              },
            },
            scales: {
              y: {
                beginAtZero: true,
                title: {
                  display: true,
                  text: "Cost ($)",
                },
              },
            },
          },
        });
      }

      function drawCashflowChart(
        baselineInitial,
        proposedInitial,
        baselineAnnual,
        proposedAnnual
      ) {
        const ctx = document.getElementById("cashflow_div");
        if (!ctx) return;

        // Clear previous chart
        ctx.innerHTML = '<canvas id="cashflowChart"></canvas>';
        const canvas = document.getElementById("cashflowChart");

        const years = 11;
        const cashflowData = [];
        const labels = [];

        for (let i = 0; i < years; i++) {
          if (i === 0) {
            labels[i] = "Initial";
            cashflowData[i] = baselineInitial - proposedInitial;
          } else {
            labels[i] = `Year ${i}`;
            cashflowData[i] =
              cashflowData[i - 1] + (baselineAnnual - proposedAnnual);
          }
        }

        new Chart(canvas, {
          type: "bar",
          data: {
            labels: labels,
            datasets: [
              {
                label: "Cash Flow",
                data: cashflowData,
                backgroundColor: "rgba(147, 182, 78, 0.8)",
                borderColor: "rgba(147, 182, 78, 1)",
                borderWidth: 1,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              title: {
                display: true,
                text: "Accumulated Cash Flow",
              },
            },
            scales: {
              y: {
                beginAtZero: true,
                title: {
                  display: true,
                  text: "Cash Flow ($)",
                },
              },
            },
          },
        });
      }

      // Helper functions
      function formatCurrency(value) {
        return (
          "$" +
          value.toLocaleString("en-US", {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2,
          })
        );
      }

      function formatEnergy(value) {
        return (
          value.toLocaleString("en-US", {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2,
          }) + " kWh"
        );
      }

      function formatYears(value) {
        return value.toLocaleString("en-US", {
          minimumFractionDigits: 1,
          maximumFractionDigits: 1,
        });
      }

      function formatPercentage(value) {
        return (
          value.toLocaleString("en-US", {
            minimumFractionDigits: 1,
            maximumFractionDigits: 1,
          }) + "%"
        );
      }

      // Update display elements
      function updateDisplay(elementId, value) {
        const element = document.getElementById(elementId);
        if (element) {
          element.textContent = value;
        }
      }

      // Data persistence
      function saveData() {
        const data = {
          electricityRate: document.getElementById("electricityRate").value,
          operationHours: document.getElementById("operationHours").value,
          baselineQuantity: document.getElementById("baselineQuantity").value,
          baselineWatts: document.getElementById("baselineWatts").value,
          baselineCost: document.getElementById("baselineCost").value,
          baselineDescription: document.getElementById("baselineDescription")
            .value,
          baselineControlQty:
            document.getElementById("baselineControlQty")?.value || 0,
          baselineControlReduction:
            document.getElementById("baselineControlReduction")?.value || 0,
          baselineControlCost:
            document.getElementById("baselineControlCost")?.value || 0,
          baselineRebateDescription:
            document.getElementById("baselineRebateDescription")?.value || "",
          baselineRebateValue:
            document.getElementById("baselineRebateValue")?.value || "",
          proposedProduct: document.getElementById("proposedProduct").value,
          proposedQuantity: document.getElementById("proposedQuantity").value,
          proposedCost: document.getElementById("proposedCost").value,
          proposedDescription: document.getElementById("proposedDescription")
            .value,
          proposedControlQty:
            document.getElementById("proposedControlQty")?.value || 0,
          proposedControlReduction:
            document.getElementById("proposedControlReduction")?.value || 0,
          proposedControlCost:
            document.getElementById("proposedControlCost")?.value || 0,
          proposedRebateDescription:
            document.getElementById("proposedRebateDescription")?.value || "",
          proposedRebateValue:
            document.getElementById("proposedRebateValue")?.value || "",
        };
        localStorage.setItem("ledCalculatorData", JSON.stringify(data));
      }

      function loadSavedData() {
        const saved = localStorage.getItem("ledCalculatorData");
        if (saved) {
          try {
            const data = JSON.parse(saved);
            Object.keys(data).forEach((key) => {
              const element = document.getElementById(key);
              if (element && data[key] !== undefined) {
                element.value = data[key];
              }
            });

            if (data.proposedProduct) {
              updateProposedWatts();
            }

            if (
              data.baselineControlQty ||
              data.baselineControlReduction ||
              data.baselineControlCost
            ) {
              document.querySelectorAll(".control-fields").forEach((field) => {
                field.style.display = "block";
                field.classList.add("show");
              });
              document.querySelector(
                'button[onclick="toggleControls()"]'
              ).textContent = "Hide Control";
            }

            if (data.baselineRebateValue || data.proposedRebateValue) {
              document.querySelectorAll(".rebate-fields").forEach((field) => {
                field.style.display = "block";
                field.classList.add("show");
              });
              document.querySelector(
                'button[onclick="toggleRebates()"]'
              ).textContent = "Hide Rebate";
            }
          } catch (e) {
            console.error("Error loading saved data:", e);
          }
        }
      }

      // Tab functionality
      function showTab(tabName) {
        const tabs = document.querySelectorAll(".tab");
        tabs.forEach((tab) => tab.classList.remove("active"));

        const activeTab = event.target;
        activeTab.classList.add("active");

        // Show/hide appropriate chart
        const chartDiv = document.getElementById("chart_div");
        const cashflowDiv = document.getElementById("cashflow_div");

        if (tabName === "tenYear") {
          chartDiv.classList.add("active");
          cashflowDiv.classList.remove("active");
        } else if (tabName === "cashflow") {
          chartDiv.classList.remove("active");
          cashflowDiv.classList.add("active");
        }
      }

      // Control and Rebate Toggle Functions
      function toggleControls() {
        const controlFields = document.querySelectorAll(".control-fields");
        const controlBtn = event.target;

        controlFields.forEach((field) => {
          if (field.style.display === "none") {
            field.style.display = "block";
            field.classList.add("show");
          } else {
            field.style.display = "none";
            field.classList.remove("show");
          }
        });

        controlBtn.textContent =
          controlBtn.textContent === "Add Control"
            ? "Hide Control"
            : "Add Control";
        calculateAll();
      }

      function toggleRebates() {
        const rebateFields = document.querySelectorAll(".rebate-fields");
        const rebateBtn = event.target;

        rebateFields.forEach((field) => {
          if (field.style.display === "none") {
            field.style.display = "block";
            field.classList.add("show");
          } else {
            field.style.display = "none";
            field.classList.remove("show");
          }
        });

        rebateBtn.textContent =
          rebateBtn.textContent === "Add Rebate" ? "Hide Rebate" : "Add Rebate";
        calculateAll();
      }

      // Action buttons
      function addControl() {
        alert(
          "Add Control functionality - This would integrate with your control system to provide more accurate energy savings calculations."
        );
      }

      function addRebate() {
        alert(
          "Add Rebate functionality - This would allow users to input available rebates and incentives to improve ROI calculations."
        );
      }

      function printResults() {
        window.print();
      }

      function showDisclaimer() {
        alert(
          "Disclaimer: This calculator provides estimates based on the information provided. Actual results may vary. Please consult with a qualified professional for detailed analysis."
        );
      }

      // Input validation
      function validateInput(input) {
        const value = parseFloat(input.value);
        if (value < 0) {
          input.value = 0;
        }
        calculateAll();
      }

      document.addEventListener("input", function (e) {
        if (e.target.type === "number") {
          validateInput(e.target);
        }
      });

      document.addEventListener("input", function (e) {
        if (
          e.target.id &&
          (e.target.id.includes("Control") || e.target.id.includes("Rebate"))
        ) {
          calculateAll();
        }
      });
    </script>
  </body>
</html>
